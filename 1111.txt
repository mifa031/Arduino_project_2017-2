/* arduino web client - GET request for index.html or index.php */

#include <SPI.h>
#include <Phpoc.h>
#include <TimeLib.h>
#include <TM1637.h>

char server_name[] = "121.128.151.144";
PhpocClient client;

void setup() {
  Serial.begin(9600);
    
  Phpoc.begin(PF_LOG_SPI | PF_LOG_NET);

  /*if(client.connect(server_name, 80))
  {
    Serial.println("Connected to server");
    client.println("GET /status.php?room_num=3 HTTP/1.0");
  }
  else
    Serial.println("connection failed");*/
}

int mode0 = 1;
String s = "";
void getLec(){
  if(mode0 == 1){
    if(1/*second()%60 == 0*/){
      if(client.connect(server_name, 80))
      {
        Serial.println("Connected to server");
        client.println("GET /status.php?room_num=3 HTTP/1.0");
        mode0 = 0;
      }
      else
        Serial.println("connection failed");
    }
  }

  if(second()%60 == 1){
    mode0 = 1;
  }

  while(client.available())
  {
    char c = client.read();
    s.concat(c);
    if(c == '\r' || c== '\n')
         s = "";
  }

  if(!client.connected())
  {
    Serial.println("disconnected");
    client.stop();
  }

  if(s.equals("lec")){
    Serial.println("Success");
    // 강의중 상태일때 수행할 코드
  }
}


void loop() {
  getLec();
}